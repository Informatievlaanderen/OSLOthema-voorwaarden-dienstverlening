@prefix cpsv: <http://purl.org/vocab/cpsv#>
@prefix dbpedia: <http://dbpedia.org/ontology#> .
@prefix dc: <http://purl.org/dc/terms#> .
@prefix dcat: <http://www.w3.org/ns/dcat#> .
@prefix dossier: <https://data.vlaanderen.be/ns/dossier#> .
@prefix eli: <http://data.europa.eu/eli/ontology#>
@prefix eu: <https://data.europa.eu/m8g#> .
@prefix example: <https://example.org/ns#> .
@prefix foaf: <http://xmlns.com/foaf/0.1#> .
@prefix p-plan: <http://purl.org/net/p-plan#> .	
@prefix persoon: <https://data.vlaanderen.be/ns/persoon#> .
@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix sd: <https://www.w3.org/TR/sparql12-service-description/#lang-sparql12query> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix skos: 	<http://www.w3.org/2004/02/skos/core#> .
@prefix step: <https://fast.ilabt.imec.be/ns/oslo-steps#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

# This example builds upon the CCCEV, OSLO-STEPS and P-PLAN vocabularies.
# In order to reduce complexity, this example does not concern itself with the reasoning at each step / activity. 
# This is outside the model, but at each state the activity output is added to the knowledge graph.

# I. Legal backing.
_:publicService a cpsv:PublicService ;
    cpsv:follows _:rule ;
    example:instantiates _:plan .

_:rule a cpsv:Rule ;
    cpsv:implements _:legalResource .

_:legalResource a eli:LegalResource .

# II. Definition of the procedure.
_:mariageDeclaration a p-plan:MultiStep ;
    dc:description "Mariage declaration" ;
    p-plan:isStepOfPlan _:mariage ;
    p-plan:isDecomposedAsPlan _:ageAbove18 .

_:ageAbove18 a p-plan:Plan, eu:Requirement ;
    p-plan:isSubPlanOfPlan _:mariage ;
    dc:description "Establish that registered person is above 18 of age." ;
    eu:hasSupportingEvidence _:evidence ;
    eu:fulfils _:rule .

_:evidence a eu:Evidence;
    dcat:identifier "xxx-xxxxxxx-xx" ;
    dcat:type "Authentication certificate of eID card";
    dc:isAbout _:subject ;
    dcat:distribution _:entity1 ;
    
_:formalStep1 a p-plan:Step, eu:Requirement ;
    dc:description "Obtain the age of citizen based on the date of birth." ;
    p-plan:isStepOfPlan _:ageAbove18 ;
    step:hasStateShape _:stateShape1 ;
    p-plan:hasInputVar _:inputVariable1 ;

# @prefix persoon: <https://data.vlaanderen.be/ns/persoon#> .
# @prefix sh: <http://www.w3.org/ns/shacl#> .
#
# persoon:GeregistreerdPersoon
#     a sh:NodeShape ;
#     sh:targetNode persoon:GeregistreerdPersoon .
_:stateShape1 a sh:NodeShape .

_:inputVariable1 a persoon:GeregistreerdPersoon .

_:formalStep2 a p-plan:Step, eu:Requirement ;
    dc:description "Verify that the registered person's age is above 18." ;
    p-plan:isStepOfPlan _:ageAbove18 ;
    p-plan:isPreceededBy _:formalStep1 ;
    step:hasStateShape _:stateShape2 ;

# @prefix example: <https://example.org/ns#> .
# @prefix person: <http://www.w3.org/ns/person#> .
# @prefix persoon: <https://data.vlaanderen.be/ns/persoon#> .
# @prefix sh: <http://www.w3.org/ns/shacl#> .
# @prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

# persoon:GeregistreerdPersoon
#     a sh:NodeShape ;
#     sh:targetNode persoon:GeregistreerdPersoon ;
#     sh:property [
#         sh:path example:Age ;
# 		  sh:datatype xsd:integer ;
#         sh:minInclusive 18 ;
#     ] .
_:stateShape2 a sh:NodeShape .

_:subject a persoon:GeregistreerdPersoon ;
    persoon:registratie "90110848689" ;
    persoon:heeftGeboorte _:dob ;
    persoon:heeftBurgelijkeStaat _:maritalStatus .

_:dob a persoon:Geboorte ;
    persoon:datum "1990-11-08T00:00:00"^^xsd:dateTime .

_:maritalStatus a persoon:BurgelijkeStaat ;
    persoon:type skos:Single .

# III. Execution of the procedure.
_:case a dbpedia:Case .
    dossier:doorloopt (_:activity1 _:activity2)

_:activity1 a p-plan:Activity, dossier:Procedurestap ;
    p-plan:correspondsToStep _:formalStep1 ;
    prov:used _:entity1 ;

_:entity1 a prov:Entity, dcat:Distribution ;
    p-plan:correspondsToVariable _:inputVariable1 ;
    dcat:mediaType <http://www.iana.org/assignments/media-types/application/ld+json> ;
    dc:conformsTo persoon:GeregistreerdPersoon ;
    prov:value """
    {
        "@context": [
        "https://data.vlaanderen.be/context/persoon-basis.jsonld",
        {"xsd": "http://www.w3.org/2001/XMLSchema#"}
        ],
        "@id": "_:subject",
        "@type": "GeregistreerdPersoon",
        "heeftGeboorte": {
            "@id": "_:dob",
            "@type": "Geboorte",
            "datum": {
                "@value": "1990-11-08T00:00:00",
                "@type": "xsd:dateTime"
            }
        }
    }
    """ .

_:activity2 a p-plan:Activity, dossier:Procedurestap ;
    p-plan:correspondsToStep _:formalStep2 ;
    prov:wasInformedBy _:activity1 .